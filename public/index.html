<!doctype html>
<html ng-app="shardalyzer-ui">
	<head>
		<title>Shardalyzer</title>
		<script src="/bower_components/jquery/dist/jquery.min.js"></script>

		<script src="/bower_components/angular/angular.min.js"></script>
		<script src="/bower_components/Chart.js/Chart.min.js"></script>

		<link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="/bower_components/angular-bootstrap/ui-bootstrap-csp.css">
		<script src="/bower_components/angular-bootstrap/ui-bootstrap.min.js"></script>
		<script src="/bower_components/angular-bootstrap/ui-bootstrap-tpls.js"></script>

		<link rel="stylesheet" href="/bower_components/seiyria-bootstrap-slider/css/bootstrap-slider.css">
		<script src="/bower_components/seiyria-bootstrap-slider/js/bootstrap-slider.js"></script>
		<script src="/bower_components/angular-bootstrap-slider/slider.js"></script>

		<link rel="stylesheet" href="/bower_components/angular-chart.js/dist/angular-chart.css">
		<script src="/bower_components/angular-chart.js/dist/angular-chart.min.js"></script>

		<link rel="stylesheet" href="/bower_components/json-formatter/dist/json-formatter.min.css">
		<script src="/bower_components/json-formatter/dist/json-formatter.min.js"></script>

		<link rel="stylesheet" href="/bower_components/jasny-bootstrap/dist/css/jasny-bootstrap.min.css" media="screen">
		<script src="/bower_components/jasny-bootstrap/dist/js/jasny-bootstrap.min.js"></script>
		<script src="/bower_components/jasny-bootstrap/js/offcanvas.js"></script>

		<link rel="stylesheet" href="/bower_components/angular-growl-v2/build/angular-growl.min.css">
		<script src="/bower_components/angular-growl-v2/build/angular-growl.min.js"></script>

		<script src="/bower_components/angular-animate/angular-animate.min.js"></script>

		<script src="/bower_components/hamsterjs/hamster.js"></script>
		<script src="/bower_components/angular-mousewheel/mousewheel.js"></script>

		<script src="/bower_components/jquery-ui/ui/minified/core.min.js"></script>
		<script src="/bower_components/jquery-ui/ui/minified/widget.min.js"></script>
		<script src="/bower_components/jquery-ui/ui/minified/mouse.min.js"></script>
		<script src="/bower_components/jquery-ui/ui/minified/sortable.min.js"></script>

		<link rel="stylesheet" href="/bower_components/bootstrap-switch/dist/css/bootstrap3/bootstrap-switch.min.css">
		<script src="/bower_components/bootstrap-switch/dist/js/bootstrap-switch.min.js"></script>
		<script src="/bower_components/angular-bootstrap-switch/dist/angular-bootstrap-switch.min.js"></script>

		<script src="/bower_components/angular-ui-sortable/sortable.min.js"></script>

		<link rel="stylesheet" href="stylesheets/chart-tooltip.css">
		<link rel="stylesheet" href="stylesheets/navmenu-push.css">
		<link rel="stylesheet" href="stylesheets/style.css">
		<script src="js/chart-tooltip.js"></script>

		<script src="js/shardalyzer.js"></script>
		<script src="js/shardalyzer-ctrl.js"></script>
	</head>

	<body>
		<div growl limit-messages="5"></div>

		<div id="navcontainer" class="container">
			<div class="navbar navbar-default navbar-fixed-top" style="width:100%;">
				<button type="button" class="navbar-toggle" data-toggle="offcanvas" data-target="#navmenu" data-canvas="#navcontainer" data-placement="left">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<span class="navbar-brand" href="#"></span>
			</div>

			<nav id="navmenu" class="navmenu navmenu-default navmenu-fixed-left offcanvas" role="navigation">
				<span class="navmenu-brand" style="padding-top:15px"><strong>Connect to Server</strong></span>
					<ul class="nav navmenu-nav" ng-controller="serverNsCtrl">
					<li class="active"><a href="#"><small>1. Specify server location</small></a></li>
					<li><a href="#">Host
							<input type="text" class="form-control" style="color: #333; font-weight:normal"
								ng-model="mongo.host" ng-model-options="{updateOn : 'default'}" ng-enter="updateNSList()" />
						</a>
					</li>
					<li><a href="#">Port
							<input type="number" class="form-control" style="color: #333; font-weight:normal" min="0" max="65535"
								ng-model="mongo.port" ng-model-options="{updateOn : 'default'}" ng-enter="updateNSList()" />
						</a>
					</li>
					<li class="active"><a href="#"><small>2. Choose a namespace to visualise</small></a></li>
					<li><a href="#">
							<select class="form-control" style="color: #333; font-weight:normal" ng-model="mongo.selectedNS" ng-options="ns as ns for ns in mongo.nsList">
								<option value="">[namespace]</option>
							</select>
						</a>
					</li>
				</ul>
			</nav>

			<div id="contentcontainer" class="flexv">

				<div id="header" class="snug" style="padding:120px 0 0 0;"></div>

				<div id="shardview" class="greedy" style="height:0px; overflow:auto" ng-show="mongo.selectedNS !== null" ng-controller="updateCharts" msd-wheel="scaleCharts($event, $delta, $deltaX, $deltaY)">
					<div id="shardedit" style="position:absolute; z-index:2">
						<div style="padding:5px">
							<button type="button" class="{{chartmeta.shardedit ? 'btn btn-primary' : 'btn btn-default'}}" ng-click="chartmeta.toggleedit();" value="Edit">
								<span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
							</button>
						</div>
						<div style="padding:5px">
							<button type="button" class="btn btn-success" ng-show="chartmeta.shardedit" ng-click="chartmeta.enableall(true);" value="All">
								<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
							</button>
						</div>
						<div style="padding:5px">
							<button type="button" class="btn btn-danger" ng-show="chartmeta.shardedit" ng-click="chartmeta.enableall(false);" value="None">
								<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
							</button>
						</div>
					</div>
					<div id="shardsorter" ui-sortable="chartmeta.sortopts" ng-model="chartmeta.shardlist" class="row-centered">
						<div ng-repeat="shard in chartmeta.shardlist" ng-if="chartmeta.shardenabled[shard] || chartmeta.shardedit" class="{{chartmeta.colclasses[chartmeta.currentcol]}} col-centered" style="opacity: {{chartmeta.shardenabled[shard] ? 1 : 0.25}}">
							<canvas id="doughnut_{{shard}}" class="chart chart-doughnut"
								chart-options="chartmeta.options"
								chart-data="chartmeta.data[shard]"
								chart-labels="mongo.shardalyzer.shards[shard]"
								chart-colours="chartmeta.colors[shard]"></canvas>
							<p align="center" style="color:{{mongo.shardalyzer.balancer[shard]}};">
								<b>{{shard}} : {{mongo.shardalyzer.shards[shard].length}}</b>
							</p>
							<div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-100%);" ng-show="chartmeta.shardedit">
								<input type="checkbox" bs-switch ng-model="chartmeta.shardenabled[shard]">
							</div>
						</div>
					</div>
				</div>

				<div id="mongospinner" ng-show="mongo.selectedNS == null" class="greedy" style="width:75%; margin: 0 auto; border-radius:25px;
					background: url('images/mongo-small.png') center no-repeat, url('images/mongo-spinner.gif') center no-repeat; background-color:white;">
				</div>

				<div id="chartjs-tooltip-shard" class="chartjs-tooltip" style="visibility:hidden; z-index:100"></div>

				<div id="shardcontrols" class="snug" style="margin: 15px 0 15px 0">
					<div class="flexh" style="width:75%; margin:0 auto;">
						<div class="snug" style="min-width:375px" ng-controller="playControl">
							<div class="btn-group" role="group">
								<button type="button" class="btn btn-primary" ng-click="playctrl.start();" value="|<">
									<span class="glyphicon glyphicon-fast-backward" aria-hidden="true"></span>
								</button>
								<button type="button" class="btn btn-info" ng-click="playctrl.fastforward();" value="<<">
									<span class="glyphicon glyphicon-backward" aria-hidden="true"></span>
								</button>
								<button type="button" class="btn btn-danger" ng-click="playctrl.forwardError();" value="! <">
									<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
								</button>
								<button type="button" class="btn btn-default" ng-click="playctrl.forward();" value="<">
									<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
								</button>
								<button type="button" class="btn btn-default" ng-click="playctrl.back();" value=">">
									<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
								</button>
								<button type="button" class="btn btn-danger" ng-click="playctrl.backError();" value="> !">
									<span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
								</button>
								<button type="button" class="btn btn-info" ng-click="playctrl.rewind();" value=">>">
									<span class="glyphicon glyphicon-forward" aria-hidden="true"></span>
								</button>
								<button type="button" class="btn btn-primary" ng-click="playctrl.end();" value=">|">
									<span class="glyphicon glyphicon-fast-forward" aria-hidden="true"></span>
								</button>
							</div>

							<button popover-template="'chunklegend.html'" popover-title="Chunk Legend" popover-trigger="mouseenter" type="button" class="btn btn-default">
								<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
							</button>

							<script type="text/ng-template" id="chunklegend.html">
								<div ng-repeat="(status, color) in mongo.shardalyzer.statuscolors" ng-if="status !== 'undefined'" ng-readonly="true"
									style="color:{{color}};"><strong>{{status}}</strong></div>
							</script>

						</div>

						<div class="greedy" ng-controller="sliderControl">
							<slider ng-model="mongo.ui.slider"
								min="slidermeta.min"
								max="slidermeta.max"
								value="mongo.ui.slider"
								ticks="mongo.ui.errors"
								ticksLabels="slidermeta.ticklabels"
								ticks_snap_bounds="slidermeta.snap"
								formatter="slidermeta.formatter">
							</slider>
						</div>
					</div>

					<div style="width:75%; margin:0 auto;" ng-style="{ 'visibility' : (mongo.shardalyzer.changes[mongo.ui.slider].details.errmsg != undefined ? 'visible' : 'hidden') }">
						<alert type="danger" style="margin: 15px 0 0 0">{{mongo.shardalyzer.changes[mongo.ui.slider].details.errmsg}}&nbsp;</alert>
					</div>
				</div>

				<div id="changelogquery" class="snug">
					<div style="width:75%; margin: auto;">
						<tabset>
							<tab heading="Changelog">
								<div ng-show="mongo.ui.showchangelog" style="width:100%; height:20em; max-height:20em; margin:0 auto; display:table; border-collapse:collapse;">
									<div id="changelist" style="display:table-cell; width:100%;" ng-controller="changelogControl">
										<select class="form-control" size=18 style="width:100%; overflow-x:scroll; overflow-y:hidden"
											ng-options="index as change | json for (index, change) in mongo.ui.changelog"
											ng-model="mongo.ui.selectedchange"
											ng-readonly="true">
										</select>
									</div>

									<div style="min-width:395px; max-width:395px; height:100%; margin: 0 0 0 5px; overflow-y:scroll; background:white" ng-show="mongo.ui.changelog[mongo.ui.selectedchange] !== undefined">
										<json-formatter json="mongo.ui.changelog[mongo.ui.selectedchange]" open="3" ng-readonly="true"></json-formatter>
									</div>
								</div>
							</tab>
							<tab heading="Query">
								<div ng-controller="queryCtrl" ng-show="mongo.ui.showchangelog" style="width:100%; margin:0 auto; display:table; border-collapse:collapse;">
									<div class="input-group">
										<span class="input-group-btn">
											<select class="form-control"
												ng-model="query.selectedColl"
												ng-init="query.selectedColl = 'changelog'"
												ng-options="coll.name as coll.name for coll in mongo.collList">
												<option value="">[collection]</option>
											</select>
										</span>

										<input type="text" class="form-control" ng-model="query.query" ng-model-options="{updateOn : 'default'}" ng-enter="query.submit()" />

										<span class="input-group-btn">
											<select class="form-control"
												ng-model="query.andreAgg"
												ng-options="value as key for (key, value) in query.andre_aggregrassi">
												<option value="">[Predefined Aggregations]</option>
											</select>
										</span>

										<span class="input-group-btn">
											<button type="button" class="btn btn-primary" ng-click="query.submit()" value="?">
												<span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
											</button>
										</span>
									</div>

									<textarea class="form-control" style="width:100%; display:table-cell; height:20em;" ng-model="query.result" ng-readonly="true"></textarea>
								</div>
							</tab>
							<button type="button" class="btn btn-default pull-right" ng-click="mongo.ui.showchangelog = (!mongo.ui.showchangelog)" value="Show/Hide">
								<span class="glyphicon {{mongo.ui.showchangelog ? 'glyphicon-menu-down' : 'glyphicon-menu-up'}}" aria-hidden="true"></span>
							</button>
						</tabset>
					</div>
				</div>

				<div class="footer" style="margin: 15px 0 0 -15px"></div>

			</div>

		</div>

	</body>

</html>